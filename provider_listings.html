<!doctype html>
<html lang="ar" dir="rtl" data-theme="auto">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>فرصي التدريبية | تدريبي</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box}
:root{--brand:#0a66b2;--brand-700:#084a85;--bg:#f5f8fc;--card:#ffffff;--line:#e6eef6;--text:#0d1b2a;--muted:#5d6f82;--shadow:0 12px 40px rgba(10,102,178,.12)}
@media(prefers-color-scheme:dark){:root{--bg:#0c1520;--card:#111c29;--line:#152235;--text:#e8eef6;--muted:#9fb0c3;--shadow:0 12px 40px rgba(0,0,0,.5)}}
html[data-mode="dark"]{--bg:#0c1520;--card:#111c29;--line:#152235;--text:#e8eef6;--muted:#9fb0c3;--shadow:0 12px 40px rgba(0,0,0,.5)}
html[data-mode="light"]{--bg:#f5f8fc;--card:#ffffff;--line:#e6eef6;--text:#0d1b2a;--muted:#5d6f82;--shadow:0 12px 40px rgba(10,102,178,.12)}
body{margin:0;background:var(--bg);color:var(--text);font-family:"Tajawal",system-ui,Arial}
.layout{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
.sidebar{background:var(--card);border-left:1px solid var(--line);position:sticky;top:0;height:100vh;padding:14px 12px;overflow:auto;z-index:60}
.brand{display:flex;align-items:center;gap:10px;padding:6px 8px;margin-bottom:8px;text-decoration:none;color:inherit}
.brand .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--brand),#46a1ff);display:grid;place-items:center;color:#fff;font-weight:900}
.brand .t{font-weight:900;color:var(--brand);font-size:18px}
.menu{display:flex;flex-direction:column;gap:6px}
.link{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:inherit;text-decoration:none}
.link:hover,.link.active{background:rgba(10,102,178,.08)}
.badge{margin-right:auto;background:rgba(10,102,178,.12);color:var(--brand);border-radius:999px;padding:2px 8px;font-size:12px}
.topbar{position:sticky;top:0;z-index:70;background:rgba(255,255,255,.8);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
@media(prefers-color-scheme:dark){.topbar{background:rgba(17,28,41,.65)}}
.topbar .right{display:flex;align-items:center;gap:8px}
.btn{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:#fff;border:0;border-radius:12px;padding:9px 14px;font-weight:800;cursor:pointer;text-decoration:none}
.btn.ghost{background:transparent;color:var(--brand);border:1px solid var(--line)}
.container{padding:16px;max-width:1320px;margin:0 auto}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
.card h3{margin:0 0 8px;font-size:15px;color:var(--muted)}
.kpi{display:flex;align-items:baseline;gap:6px}
.kpi .n{font-size:26px;font-weight:900;color:var(--brand)}
.cols-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th,.table td{padding:10px;background:var(--card);border:1px solid var(--line)}
.table th{color:var(--muted);font-weight:700}
.table td:first-child,.table th:first-child{border-radius:8px 0 0 8px}
.table td:last-child,.table th:last-child{border-radius:0 8px 8px 0}
.small{font-size:12px;color:var(--muted)}
.flex{display:flex;gap:8px;align-items:center}
.input{padding:10px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--text)}
.select{padding:10px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--text)}
.mode{border:1px solid var(--line);background:var(--card);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.burger{display:none;border:1px solid var(--line);background:var(--card);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);z-index:50;opacity:0;visibility:hidden;transition:.25s}
.backdrop.show{opacity:1;visibility:visible}
.toast{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:rgba(10,102,178,.08);color:var(--text);border:1px solid #9ad0ff;border-radius:12px;padding:10px 14px;z-index:90;opacity:0;pointer-events:none;transition:.25s}
.toast.show{opacity:1}
@media(max-width:1200px){.grid{grid-template-columns:1fr 1fr}.cols-2{grid-template-columns:1fr}}
@media(max-width:980px){.layout{grid-template-columns:1fr}.sidebar{position:fixed;inset:0 0 0 auto;width:min(280px,86vw);transform:translateX(100%);transition:transform .25s ease, box-shadow .25s;box-shadow:var(--shadow)}.sidebar.open{transform:translateX(0)}.burger{display:inline-block}}
@media(max-width:720px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="layout">
<aside class="sidebar" id="sidebar">
  <a class="brand" href="index.html"><div class="logo">ت</div><div class="t">تدريبي</div></a>
  <nav class="menu">
    <a class="link active" href="index.html">لوحة المزود</a>
    <a class="link" href="provider_listings.html" data-open="listings">فرصي التدريبية</a>
    <a class="link" href="provider_applications.html" data-open="applications">طلبات المتقدمين</a>
    <a class="link" href="provider_settings.html" data-open="settings">إعدادات الحساب</a>
    <a class="link" href="login.html" data-open="logout">خروج</a>
  </nav>
</aside>
<div id="backdrop" class="backdrop"></div>
<main>
  <header class="topbar">
    <div class="right">
      <button id="burger" class="burger" type="button" aria-label="القائمة">☰</button>
      <strong id="hello"></strong>
      <span class="small" id="roleTag"></span>
    </div>
    <div class="right">
      <button id="mode" class="mode" type="button">الوضع: تلقائي</button>
      <a class="btn ghost" href="#">الصفحة الرئيسية</a>
      <a class="btn" href="#">خروج</a>
    </div>
  </header>
  <div class="container">
    <div class="card" style="margin-bottom:12px">
      <form id="filterForm" class="flex" style="flex-wrap:wrap;gap:10px">
        <input class="input" type="text" id="q" placeholder="بحث بالعنوان/الموقع/الوصف/الشروط" style="flex:1;min-width:260px">
        <select class="select" id="deadlineF">
          <option value="">كل المواعيد</option>
          <option value="upcoming">قادمة/غير محددة</option>
          <option value="past">منتهية</option>
        </select>
        <select class="select" id="sort">
          <option value="created_at_desc">الأحدث أولًا</option>
          <option value="created_at_asc">الأقدم أولًا</option>
          <option value="title_asc">العنوان (أ-ي)</option>
          <option value="title_desc">العنوان (ي-أ)</option>
          <option value="deadline_asc">الأقرب للموعد</option>
          <option value="deadline_desc">الأبعد للموعد</option>
        </select>
        <button class="btn" type="submit">تصفية</button>
        <button class="btn ghost" type="button" id="openCreate">+ فرصة جديدة</button>
      </form>
      <div class="small" style="margin-top:6px">النتائج: <span id="totalCount">0</span> فرصة</div>
    </div>
    <div class="card">
      <table class="table" id="listingsTable" style="width:100%">
        <thead>
          <tr>
            <th>العنوان</th>
            <th>الموقع</th>
            <th>المدة</th>
            <th>الموعد النهائي</th>
            <th>طلبات</th>
            <th>التسجيل</th>
            <th>إجراءات</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="flex" id="pagination" style="justify-content:center;margin-top:10px;flex-wrap:wrap;gap:6px"></div>
    </div>
  </div>
</main>
</div>
<div class="toast" id="toast"></div>
<div id="modalWrap" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60">
  <div id="modalBg" style="position:absolute;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px)"></div>
  <div id="modalCard" class="card" style="position:relative;width:min(820px,96%);max-height:92vh;overflow:auto">
    <div class="flex" style="justify-content:space-between;margin-bottom:8px">
      <strong id="modalTitle">نموذج</strong>
      <button id="closeModal" class="btn ghost" type="button" style="padding:6px 10px">إغلاق</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>
<script>
var uname=localStorage.getItem('tadribi_uname')||'مزود';
var role='provider';
var per=12;
var qState="";var deadlineState="";var sortState="created_at_desc";var pageState=1;
var listings=JSON.parse(localStorage.getItem('tadribi_provider_listings_full')||'null');
if(!listings){
  listings=[
    {id:101,title:'تدريب على التسويق الرقمي',description:'تعلم حملات الإعلانات وإدارة المنصات.',eligibility:'خلفية تسويق أساسية',location:'الرياض',duration:'3 أشهر',application_deadline:'2025-10-30 23:59:00',created_at:'2025-09-20 09:10:00'},
    {id:102,title:'برمجة بايثون لطلبة الجامعات',description:'أساسيات بايثون ومشاريع عملية.',eligibility:'مقدمة برمجة',location:'جدة',duration:'6 أسابيع',application_deadline:'2025-10-15 23:59:00',created_at:'2025-09-18 14:22:00'},
    {id:103,title:'تحليل بيانات أولي',description:'خطوات التحليل باستخدام بايثون/إكسل.',eligibility:'إحصاء 1',location:'الدمام',duration:'8 أسابيع',application_deadline:'2025-11:05 23:59:00'.replace(':','-'),created_at:'2025-09-17 10:05:00'},
    {id:104,title:'تصميم تجربة المستخدم',description:'مبادئ UX وبحوث المستخدم.',eligibility:'شغف بالتصميم',location:'مكة',duration:'4 أسابيع',application_deadline:'2025-10-05 12:00:00',created_at:'2025-09-15 12:40:00'},
    {id:105,title:'إدارة المشاريع العملية',description:'أُطر العمل وخطط التنفيذ.',eligibility:'معرفة عامة',location:'أبها',duration:'10 أسابيع',application_deadline:'',created_at:'2025-09-12 08:33:00'}
  ];
  localStorage.setItem('tadribi_provider_listings_full',JSON.stringify(listings));
}
var apps=JSON.parse(localStorage.getItem('tadribi_provider_apps_detailed')||'null');
function appsCountFor(lid){if(!apps||!apps.length)return 0;return apps.filter(function(a){return Number(a.lid)===Number(lid)}).length}
function save(){localStorage.setItem('tadribi_provider_listings_full',JSON.stringify(listings))}
function toast(msg){var t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2000)}
function ymdhms(d){var y=d.getFullYear();var m=String(d.getMonth()+1).padStart(2,'0');var da=String(d.getDate()).padStart(2,'0');var h=String(d.getHours()).padStart(2,'0');var mi=String(d.getMinutes()).padStart(2,'0');var s=String(d.getSeconds()).padStart(2,'0');return y+'-'+m+'-'+da+' '+h+':'+mi+':'+s}
function toInputDT(val){if(!val)return'';var t=new Date(val.replace(' ','T'));if(isNaN(t))return'';return t.toISOString().slice(0,16)}
function fromInputDT(val){if(!val)return'';var t=new Date(val);if(isNaN(t))return'';return ymdhms(t)}
function matchDeadlineFilter(item){if(!deadlineState)return true;var dl=item.application_deadline&&new Date(item.application_deadline.replace(' ','T'));if(deadlineState==='upcoming'){return !item.application_deadline || (dl && dl>=new Date())}if(deadlineState==='past'){return (item.application_deadline && dl && dl<new Date())}return true}
function filteredSorted(){var arr=listings.slice();if(qState){var ql=qState.toLowerCase();arr=arr.filter(function(l){return [l.title,l.location,l.duration,l.description,l.eligibility].join(' ').toLowerCase().includes(ql)})}arr=arr.filter(matchDeadlineFilter);var cmp=function(a,b){return 0};if(sortState==='created_at_desc'){cmp=function(a,b){return new Date(b.created_at)-new Date(a.created_at)}}
else if(sortState==='created_at_asc'){cmp=function(a,b){return new Date(a.created_at)-new Date(b.created_at)}}
else if(sortState==='title_asc'){cmp=function(a,b){return a.title.localeCompare(b.title,'ar')}}
else if(sortState==='title_desc'){cmp=function(a,b){return b.title.localeCompare(a.title,'ar')}}
else if(sortState==='deadline_asc'){cmp=function(a,b){var ad=a.application_deadline?new Date(a.application_deadline):null;var bd=b.application_deadline?new Date(b.application_deadline):null;if(!ad && !bd) return 0; if(!ad) return 1; if(!bd) return -1; return ad-bd}}
else if(sortState==='deadline_desc'){cmp=function(a,b){var ad=a.application_deadline?new Date(a.application_deadline):null;var bd=b.application_deadline?new Date(b.application_deadline):null;if(!ad && !bd) return 0; if(!ad) return 1; if(!bd) return -1; return bd-ad}}
arr.sort(cmp);return arr}
function renderTable(){var arr=filteredSorted();var total=arr.length;document.getElementById('totalCount').textContent=total;var pages=Math.max(1,Math.ceil(total/per));if(pageState>pages)pageState=pages;var start=(pageState-1)*per;var slice=arr.slice(start,start+per);var tb=document.querySelector('#listingsTable tbody');tb.innerHTML='';if(!slice.length){var tr=document.createElement('tr');var td=document.createElement('td');td.colSpan=7;td.className='small';td.textContent='لا توجد بيانات';tr.appendChild(td);tb.appendChild(tr)}else{slice.forEach(function(r){var tr=document.createElement('tr');tr.setAttribute('data-id',r.id);tr.setAttribute('data-title',r.title||'');tr.setAttribute('data-location',r.location||'');tr.setAttribute('data-duration',r.duration||'');tr.setAttribute('data-deadline',toInputDT(r.application_deadline)||'');tr.setAttribute('data-description',r.description||'');tr.setAttribute('data-eligibility',r.eligibility||'');tr.innerHTML='<td>'+r.title+'</td><td>'+r.location+'</td><td>'+r.duration+'</td><td class="small">'+(r.application_deadline||'—')+'</td><td>'+appsCountFor(r.id)+'</td><td class="small">'+r.created_at+'</td><td><div class="flex"><button class="btn" type="button" style="padding:6px 10px" data-edit>تعديل</button><button class="btn ghost" type="button" data-del style="padding:6px 10px;border-color:#f4caca;color:#b11">حذف</button><a class="btn ghost" href="#applications" style="padding:6px 10px">عرض الطلبات</a></div></td>';
  tb.appendChild(tr)})}
var pag=document.getElementById('pagination');pag.innerHTML='';for(var i=1;i<=pages;i++){var a=document.createElement('a');a.href="#";a.className='btn '+(i===pageState?'':'ghost');a.textContent=i;a.dataset.page=i;a.style.padding='6px 10px';pag.appendChild(a)}}
function createListing(){var now=new Date();var id=(listings.map(function(i){return i.id}).reduce(function(a,b){return Math.max(a,b)},100)||100)+1;var f=document.getElementById('modalBody').querySelector('form');var t=f.title.value.trim();if(!t){toast('أكمل الحقول المطلوبة');return}var loc=f.location.value.trim();var dur=f.duration.value.trim();var dl=fromInputDT(f.application_deadline.value);var desc=f.description.value.trim();var eli=f.eligibility.value.trim();listings.push({id:id,title:t,location:loc,duration:dur,application_deadline:dl,description:desc,eligibility:eli,created_at:ymdhms(now)});save();closeModal();renderTable();toast('تم إنشاء فرصة تدريبية')}
function updateListing(id){var it=listings.find(function(x){return Number(x.id)===Number(id)});if(!it)return;var f=document.getElementById('modalBody').querySelector('form');var t=f.title.value.trim();if(!t){toast('أكمل الحقول المطلوبة');return}it.title=t;it.location=f.location.value.trim();it.duration=f.duration.value.trim();it.application_deadline=fromInputDT(f.application_deadline.value);it.description=f.description.value.trim();it.eligibility=f.eligibility.value.trim();save();closeModal();renderTable();toast('تم تحديث بيانات الفرصة')}
function deleteListing(id){var idx=listings.findIndex(function(x){return Number(x.id)===Number(id)});if(idx===-1)return;if(!confirm('حذف الفرصة نهائيًا؟'))return;listings.splice(idx,1);save();renderTable();toast('تم حذف الفرصة')}
function openModal(t,html){document.getElementById('modalTitle').textContent=t;document.getElementById('modalBody').innerHTML=html;document.getElementById('modalWrap').style.display='flex';document.querySelectorAll('[data-close-modal]').forEach(function(b){b.addEventListener('click',closeModal)})}
function closeModal(){document.getElementById('modalWrap').style.display='none';document.getElementById('modalBody').innerHTML=''}
function initMode(){var mb=document.getElementById('mode');var m=localStorage.getItem('mode');if(m==='dark'){document.documentElement.setAttribute('data-mode','dark');mb.textContent='الوضع: ليلي'}else if(m==='light'){document.documentElement.setAttribute('data-mode','light');mb.textContent='الوضع: نهاري'}else{document.documentElement.removeAttribute('data-mode');mb.textContent='الوضع: تلقائي'}mb.addEventListener('click',function(){var html=document.documentElement,cur=html.getAttribute('data-mode');if(cur==='dark'){html.setAttribute('data-mode','light');localStorage.setItem('mode','light');this.textContent='الوضع: نهاري'}else if(cur==='light'){html.removeAttribute('data-mode');localStorage.removeItem('mode');this.textContent='الوضع: تلقائي'}else{html.setAttribute('data-mode','dark');localStorage.setItem('mode','dark');this.textContent='الوضع: ليلي'}})}
function initMenu(){var burger=document.getElementById('burger'),sidebar=document.getElementById('sidebar'),backdrop=document.getElementById('backdrop');function openMenu(){sidebar.classList.add('open');backdrop.classList.add('show');document.body.style.overflow='hidden'}function closeMenu(){sidebar.classList.remove('open');backdrop.classList.remove('show');document.body.style.overflow=''}if(burger)burger.addEventListener('click',openMenu);if(backdrop)backdrop.addEventListener('click',closeMenu);document.querySelectorAll('.menu .link').forEach(function(el){el.addEventListener('click',closeMenu)})}
function initFilters(){document.getElementById('filterForm').addEventListener('submit',function(e){e.preventDefault();qState=document.getElementById('q').value.trim();deadlineState=document.getElementById('deadlineF').value;sortState=document.getElementById('sort').value;pageState=1;renderTable()})}
function initModal(){document.getElementById('openCreate').addEventListener('click',function(){openModal('فرصة جديدة','\
  <form class="flex" style="flex-direction:column;gap:10px">\
    <input name="title" placeholder="العنوان" required class="input">\
    <div class="flex" style="gap:8px;flex-wrap:wrap">\
      <input name="location" placeholder="الموقع" class="input" style="flex:1;min-width:180px">\
      <input name="duration" placeholder="المدة" class="input" style="flex:1;min-width:140px">\
      <input type="datetime-local" name="application_deadline" class="input" style="flex:1;min-width:220px">\
    </div>\
    <textarea name="description" placeholder="الوصف" class="input" style="min-height:110px"></textarea>\
    <textarea name="eligibility" placeholder="شروط الأهلية" class="input" style="min-height:90px"></textarea>\
    <div class="flex" style="justify-content:flex-end;gap:8px">\
      <button type="button" class="btn ghost" data-close-modal style="padding:6px 10px">إلغاء</button>\
      <button type="button" class="btn" id="saveCreate" style="padding:6px 10px">حفظ</button>\
    </div>\
  </form>');document.getElementById('saveCreate').addEventListener('click',createListing)})}
function initTableEvents(){document.getElementById('listingsTable').addEventListener('click',function(e){var ed=e.target.closest('[data-edit]');var dl=e.target.closest('[data-del]');var tr=e.target.closest('tr');if(ed&&tr){var id=tr.getAttribute('data-id');openModal('تعديل فرصة تدريبية','\
  <form class="flex" style="flex-direction:column;gap:10px">\
    <input name="title" placeholder="العنوان" required class="input" value="'+(tr.getAttribute('data-title')||'')+'">\
    <div class="flex" style="gap:8px;flex-wrap:wrap">\
      <input name="location" placeholder="الموقع" class="input" style="flex:1;min-width:180px" value="'+(tr.getAttribute('data-location')||'')+'">\
      <input name="duration" placeholder="المدة" class="input" style="flex:1;min-width:140px" value="'+(tr.getAttribute('data-duration')||'')+'">\
      <input type="datetime-local" name="application_deadline" class="input" style="flex:1;min-width:220px" value="'+(tr.getAttribute('data-deadline')||'')+'">\
    </div>\
    <textarea name="description" placeholder="الوصف" class="input" style="min-height:110px">'+(tr.getAttribute('data-description')||'')+'</textarea>\
    <textarea name="eligibility" placeholder="شروط الأهلية" class="input" style="min-height:90px">'+(tr.getAttribute('data-eligibility')||'')+'</textarea>\
    <div class="flex" style="justify-content:flex-end;gap:8px">\
      <button type="button" class="btn ghost" data-close-modal style="padding:6px 10px">إلغاء</button>\
      <button type="button" class="btn" id="saveEdit" style="padding:6px 10px">حفظ</button>\
    </div>\
  </form>');document.getElementById('saveEdit').addEventListener('click',function(){updateListing(id)})}
  if(dl&&tr){deleteListing(tr.getAttribute('data-id'))}})}
function initPagination(){document.getElementById('pagination').addEventListener('click',function(e){if(e.target.dataset.page){e.preventDefault();pageState=Number(e.target.dataset.page);renderTable()}})}
function boot(){document.getElementById('hello').textContent='مرحبًا، '+uname;document.getElementById('roleTag').textContent='دور: '+(role||'—');initMode();initMenu();initFilters();initModal();initTableEvents();initPagination();renderTable();document.getElementById('modalBg').addEventListener('click',closeModal);document.getElementById('closeModal').addEventListener('click',closeModal)}
boot()
</script>
</body>
</html>
